# chapter 02 의존성 역전하기

## 단일 책임 원칙
- 하나의 컴포넌트는 오로지 한 가지 일만 해야 하고, 그것을 올바르게 수행해야 한다.
  - 단일 책임 원칙의 실제 정의는 다음과 같다.
    - 컴포넌트를 변경하는 이유는 오직 하나뿐이어야 한다.
- 만약 컴포넌트를 변경할 이유가 오로지 한 가지라면 컴포넌트는 딱 한가지 일만 하게 된다. 하지만 이보다 더 중요한 것은 변경할 이유가 오직 한 가지라는 그 자체다.

## 부수효과에 관한 이야기
- 그 이유를 들어보니, 이전 개발팀에서 과거에 컴포넌트를 변경했을 때 언제나 다른 무언가가 망가졌기 때문에 변경에 대한 부수효과를 우려했던 것이었다.

## 의존성 역전 원칙
- 영속성 계층에 대한 도메인 계층의 의존성 때문에 영속성 계층을 변경할 때마다 잠재적으로 도메인 계층도 변경해야 한다. 그러나 도메인 코드는 어플리케이션 가장 중요한 코드다. 영속성 코드가 바뀐다고 해서 도메인 코드까지 바꾸고 싶지는 않다.
- 코드상의 어떤 의존성이든 그 방향을 바꿀 수(역전시킬 수) 있다.

## 클린 아키텍처
- 도메인 코드가 바끝으로 향하는 어떤 의존성도 없어야 함을 의미한다. 대신 의존성 역전 원칙의 도움으로 모든 의존성이 도메인 코드를 향하고 있다.
- 이 아키텍처의 코어(core)에는 유스케이스에서 접근하는 도메인 엔티티들이 있다. 유스케이스는 앞에서 서비스라고 불렀던 것들인데, 단일 책임(즉 변경할 단 한가지의 이유)을 갖기 위해 조금 더 세분화돼 있다. 이를 통해 이전에 이야기 했던 넓은 서비스 문제를 피할 수 있다.
- 짐작했을지도 모르지만 클린 아키텍처에는 대가가 따른다. 도메인 계층이 영속성이나 UI 같은 외부 계층과 철저하게 분리돼야 하므로 애플리케이션의 엔티티에 대한 모델을 각 계층에서 유지보수해야 한다.
- 도메인계층은 영속성 계층을 모르기 때문에 도메인 계층에서 사용한 엔티티 클래스를 영속성 계층에서 함께 사용할 수없고 두 계층에서 각각 엔티티를 만들어야 한다. 즉 도메인 계층과 영속성 계층이 데이터를 주고받을 때, 두 엔티티를 서로 변홬해야 한다는 뜻이다. 이는 도메인 계층과 다른 계층들 사이에서도 마찬가지다.
- 이것은 바람직한 일이다. 이것이 바로 도메인 코드를 프레임워크에 특화된 문제로부터 해방시키고자 했던, 결합이 제거된상태다.

## 육각형 아키텍처(헥사고날 아키텍처)
- 육각형 안에는 도메인 엔티티와 상호작용하는 유스케이스가 있다. 육각형에서 외부로 향하는 의존성이 없기 때문에 마틴이 클린 아키텍처에서 제시한 의존성 규칙이 그대로 적용된다는 점을 주목하자.대신 모든 의존성은 코어를 향한다.
- 왼쪽에 있는 어댑터들은 (애플리케이션 코어를 호출하기 때문에) 애플리케이션을 주도하는 어댑터들이다. 반면 오른쪽에 있는 어댑터들은 (애플리케이션 코어에 의해 호출되기 때문에) 애플리케이션에 의해 주도되는 어댑터들이다.

## 유지보수 가능한 소프트웨어를 만드는데 어떻게 도움이 될까?
- 모든 문제로부터 도메인 로직의 결합을 제거하고 코드를 변경할 이유의 수를 줄일 수 있다. 그리고 변경할 이유가 적을수록 유지보수성은 더 좋아진다.
