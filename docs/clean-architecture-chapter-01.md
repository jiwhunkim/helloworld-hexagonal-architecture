# chapter 01 계층형 아키텍처의 문제는 무엇일까?

- 사실 계층형 아키텍터는 견고한 아키텍처 패턴이다. 계층을 잘 이해하고 구성한다면 계층이나 영속성 계층에 독립적으로 도메인 로직을 작성할 수 있다. 원한다면 도메인 로직에 영향을 주지 않고 웹 계층과 영속성 계층에 사용된 기술을 변경할 수 있다. 기존 기능에 영향을 주지 않고 새로운 기능을 추가할 수도 있다.
- 내 경험에 의하면 계층형 아키텍처는 코드에 나쁜 습관들이 스며들기 쉽게 만들고 시간이 지날수록 소프트웨어를 점점 더 변경하기 어렵게 만든느 수많은 허점들을 노출한다.

## 계층형 아키텍처는 데이터베이스 주도 설계를 유도한다.
- 다른 무엇보다도 도멩니 로직을 먼저 만들어야 한다. 그래야만 우리가 로직을 제대로 이해했는지 확인할 수 있다. 그리고 도메인 로직이 맞다는 것을 확인한  후에 이를 기반으로 영속성 계층과 웹 계층을 만들어야 한다.
- ORM 프레임워크를 계층형 아키텍처와 결합하면 비즈니스 규칙을 영속성 관점과 섞고 싶은 유혹을 쉽게 받는다.

## 지름길을 택하기 쉬워진다.
- 특히나 마감이 다가오는 상황이라면 더더욱 말이다. 또, 과거에도 이와 똑같은 전력이 있다면 재차 그렇게 하는 것에 대한 심리적 부담감은 훨씬 낮아지기 마련이다. 이를 두고 심리학에서는 '깨진 창문 이론'(11장에서 더 자세히 알아본다)이라고 부른다.
- 영속성 계층은 컴포넌트 아래 계층으로 내릴수록 비대해진다. 어떤 계층에도 속하지 않는 것처럼 보이는 헬페 컴포넌트나 유틸리느 컴포넌트들이 이처럼 아래 계층으로 내릴 가능성이  큰 후보이다.

## 테스트하기 어려워진다.
- 시간이 흘러 웹 컴포넌트의 규모가 커지면 다양한 영속성 컴포넌트에 의존성이 많이 쌓이면서 테스트 복잡도를 높인다. 어느 순간에는 실제로 테스트 코드를 작성하는 것보다 종속성을 이해하고 목(mock)을  만드는데 더 많은 시간이 걸리게 된다.

## 유스케이스를 숨긴다.
- 기능을 추가하거나 변경할 적절한 위치를 찾는 일이 빈번하기 때문에 아키텍처는 코드를 빠르게 탐색하는 데 도움이 돼야 한다. 이런 괌점에서 계층형 아키텍처는 어떻게 우리의 발목을 잡을까?
- 계층형 아키텍처에서는 도메인 로직이 여러 계층에 걸쳐 흩어지기 쉽다.

## 동시 작업이 어려워진다.
- 기대를 충족시키려면 아키텍처가 동시 작업을 지원해야 하지만 이렇게 하기란 쉽지는 않다. 그리고 계층형 아키텍처는 이런 측면에서는 그다지 도움이 되지 않는다.
- 모든 것이 영속성 계층 위에 만들어지기 때문에 영속성 계층을 먼저 개밸해야 하고, 그다음에 도메인 계층을, 그리고 마지막으로 웹 계층을 만들어야 한다. 그렇기 때문에 동시에 한 명의 개발자만 작업할 수 있다.
- 데이터베이스 주도 설계는 영속성 로직이 도메인 로직과 너무 뒤섞여서 각 측면을 개별적으로 작업할 수 없기 때문이다.

## 유지보수 가능한 소프트웨어를 만드는 데 어떻게 도움이 될까?
- 계층형 아키텍처로 만들든 다른 아키텍처 스타일로 만들든, 계층형 아키텍처의 함정을 염두에 두면 지름길을 택하지 않고 유지보수하기에 더 쉬운 솔루션을 만드는 데 도움이 될 것이다.
